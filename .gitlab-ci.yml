stages:
    - create_docker_images
    - build_deployments

services: 
    - docker:dind
kafka_image_job :
    stage: create_docker_images
    image: docker:latest
    script:
        - cd Kafka
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_start_kafka -t $CI_REGISTRY_IMAGE/ubuntu_with_kafka  .
        - docker push $CI_REGISTRY_IMAGE/ubuntu_with_kafka 
       
    only:
        changes:
            - Kafka/**/*
services: 
    - docker:dind
Generator_image_job :
    stage: create_docker_images
    image: docker:latest
    script:
        - cd Generator
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_generator -t $CI_REGISTRY_IMAGE/ubuntu_with_generator  .
        - docker push $CI_REGISTRY_IMAGE/ubuntu_with_generator
    only:
        changes:
            - Generator/**/*

services: 
    - docker:dind
logger_image_job :
    stage: create_docker_images
    image: docker:latest
    script:
        - cd Logger
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_logger -t $CI_REGISTRY_IMAGE/python_with_logger .
        - docker push $CI_REGISTRY_IMAGE/python_with_logger
    only:
        changes:
            - Logger/**/*

services: 
    - docker:dind
collector_image_job :
    stage: create_docker_images
    image: docker:latest
    script:
        - cd Collector
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_collector -t $CI_REGISTRY_IMAGE/python_with_collector .
        - docker push $CI_REGISTRY_IMAGE/python_with_collector
    only:
        changes:
            - Collector/**/*

services: 
    - docker:dind
estimator_image_job :
    stage: create_docker_images
    image: docker:latest
    script:
        - cd Estimator
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_estimator -t $CI_REGISTRY_IMAGE/python_with_estimator .
        - docker push $CI_REGISTRY_IMAGE/python_with_estimator

    only:
        changes:
            - Estimator/**/*

services: 
    - docker:dind
learner_image_job :
    stage: create_docker_images
    image: docker:latest
    script:
        - cd Learner
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_learner -t python_with_learner .
        - docker push $CI_REGISTRY_IMAGE/python_with_learner
    only:
        changes:
            - Learner/**/*
            
services: 
    - docker:dind
monitor_image_job :
    stage: create_docker_images
    image: docker:latest
    script:
        - cd Monitor
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_monitor -t python_with_monitor .
        - docker push $CI_REGISTRY_IMAGE/python_with_monitor
    only:
        changes:
            - Monitor/**/*
