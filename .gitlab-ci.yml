stages:
    - build
    #- test
    #- quality
    #- package

services: 
    - docker:dind
kafka_build :
    stage: build
    image: docker:latest
    script:
        - cd Kafka
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_start_kafka -t $CI_REGISTRY_IMAGE/ubuntu_with_kafka  .
        #- docker push $CI_REGISTRY_IMAGE/ubuntu_with_kafka 
<<<<<<< HEAD
       
=======
    retry : 2   
>>>>>>> f9f376b1b5cccf4448c31ddaf8c4d9b4514126f1
    only:
        refs:
            - master
        #changes:
        #    - Kafka/**/*
services: 
    - docker:dind
Generator_build :
    stage: build
    image: docker:latest
    script:
        - cd Generator
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_generator -t $CI_REGISTRY_IMAGE/ubuntu_with_generator  .
<<<<<<< HEAD
        #- docker push $CI_REGISTRY_IMAGE/ubuntu_with_generator
=======
        #- docker run --rm --network="host" -it $CI_REGISTRY_IMAGE/ubuntu_with_generator
        #- docker push $CI_REGISTRY_IMAGE/ubuntu_with_generator
    retry : 2
>>>>>>> f9f376b1b5cccf4448c31ddaf8c4d9b4514126f1
    only:
        refs:
            - master
    when: on_success # s'ex√©cutera uniquement si le job kafka_build

services: 
    - docker:dind
logger_build :
    stage: build
    image: docker:latest
<<<<<<< HEAD
    allow_failure:true
=======
    allow_failure : true
>>>>>>> f9f376b1b5cccf4448c31ddaf8c4d9b4514126f1
    script:
        - cd Logger
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_logger -t $CI_REGISTRY_IMAGE/python_with_logger .
        - docker push $CI_REGISTRY_IMAGE/python_with_logger
    only:
        refs :
            - master
        
services: 
    - docker:dind
collector_build :
    stage: build
    image: docker:latest
    script:
        - cd Collector
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_collector -t $CI_REGISTRY_IMAGE/python_with_collector .
    #   - docker push $CI_REGISTRY_IMAGE/python_with_collector
    only:
        refs :
            - master
    when: on_success 

    services: 
    - docker:dind
estimator_build :
    stage: build
    image: docker:latest
    script:
        - cd Estimator
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_estimator -t $CI_REGISTRY_IMAGE/python_with_estimator .
        #- docker push $CI_REGISTRY_IMAGE/python_with_estimator

    only:
        refs :
            - master
    when : on_success

services: 
    - docker:dind
<<<<<<< HEAD
learner_image_job :
=======
learner_build :
>>>>>>> f9f376b1b5cccf4448c31ddaf8c4d9b4514126f1
    stage: build
    image: docker:latest
    allow_failure : true
    script:
        - cd Learner
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_learner -t $CI_REGISTRY_IMAGE/python_with_learner .
        #- docker push $CI_REGISTRY_IMAGE/python_with_learner
    only:
        refs :
            - master
        #changes:
        #    - Learner/**/*
            
services: 
    - docker:dind
<<<<<<< HEAD
monitor_image_job :
=======
monitor_build :
>>>>>>> f9f376b1b5cccf4448c31ddaf8c4d9b4514126f1
    stage: build
    image: docker:latest
    allow_failure : true
    script:
        - cd Monitor
        - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
        - docker build -f Dockerfile_monitor -t $CI_REGISTRY_IMAGE/python_with_monitor .
        #- docker push $CI_REGISTRY_IMAGE/python_with_monitor
    only:
        refs : 
            - master
        #changes:
        #    - Monitor/**/*
